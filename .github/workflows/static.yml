name: Deploy All Files from Digital Garden

on:
  push:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      # –®–ê–ì 1: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ notes
      - name: List all files in notes directory
        run: |
          echo "üìÅ –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ src/site/notes/:"
          echo "=========================================="
          
          # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É
          cd src/site/notes/
          
          # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –í–°–ï —Ñ–∞–π–ª—ã —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
          echo "–î–µ—Ä–µ–≤–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:"
          find . -type f | sort | sed 's|^\./||' | while read file; do
            size=$(stat -c%s "$file" 2>/dev/null || wc -c < "$file")
            echo "  üìÑ $file (${size} bytes)"
          done
          
          echo ""
          echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:"
          echo "  –í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: $(find . -type f | wc -l)"
          echo "  HTML —Ñ–∞–π–ª–æ–≤: $(find . -name "*.html" -o -name "*.htm" | wc -l)"
          echo "  –î—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤: $(find . -type f ! -name "*.html" ! -name "*.htm" | wc -l)"
        
      # –®–ê–ì 2: –°–æ–∑–¥–∞—ë–º —É–ª—É—á—à–µ–Ω–Ω—ã–π index.html —Å–æ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –í–°–ï —Ñ–∞–π–ª—ã (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å)
      - name: Create enhanced index.html
        run: |
          cd src/site/notes/
          echo "–°–æ–∑–¥–∞—é index.html —Å–æ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –≤—Å–µ —Ñ–∞–π–ª—ã..."
          
          # –ù–∞—á–∏–Ω–∞–µ–º HTML - –∏—Å–ø–æ–ª—å–∑—É–µ–º echo —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å YAML
          echo '<!DOCTYPE html>' > index.html
          echo '<html lang="ru">' >> index.html
          echo '<head>' >> index.html
          echo '    <meta charset="UTF-8">' >> index.html
          echo '    <meta name="viewport" content="width=device-width, initial-scale=1.0">' >> index.html
          echo '    <title>üìö –¶–∏—Ñ—Ä–æ–≤–æ–π —Å–∞–¥ - –í—Å–µ —Ñ–∞–π–ª—ã</title>' >> index.html
          echo '    <style>' >> index.html
          echo '        :root {' >> index.html
          echo '            --primary: #2ea44f;' >> index.html
          echo '            --bg: #f6f8fa;' >> index.html
          echo '            --card: #ffffff;' >> index.html
          echo '            --text: #24292f;' >> index.html
          echo '            --border: #d0d7de;' >> index.html
          echo '        }' >> index.html
          echo '        * { margin: 0; padding: 0; box-sizing: border-box; }' >> index.html
          echo '        body {' >> index.html
          echo '            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;' >> index.html
          echo '            background: var(--bg);' >> index.html
          echo '            color: var(--text);' >> index.html
          echo '            line-height: 1.6;' >> index.html
          echo '            padding: 20px;' >> index.html
          echo '            max-width: 1200px;' >> index.html
          echo '            margin: 0 auto;' >> index.html
          echo '        }' >> index.html
          echo '        header { ' >> index.html
          echo '            text-align: center; ' >> index.html
          echo '            margin: 40px 0 60px 0;' >> index.html
          echo '            padding-bottom: 20px;' >> index.html
          echo '            border-bottom: 2px solid var(--border);' >> index.html
          echo '        }' >> index.html
          echo '        h1 { ' >> index.html
          echo '            font-size: 2.8rem; ' >> index.html
          echo '            margin-bottom: 10px;' >> index.html
          echo '            color: var(--primary);' >> index.html
          echo '        }' >> index.html
          echo '        .stats-grid {' >> index.html
          echo '            display: grid;' >> index.html
          echo '            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));' >> index.html
          echo '            gap: 15px;' >> index.html
          echo '            margin: 30px 0;' >> index.html
          echo '        }' >> index.html
          echo '        .stat-card {' >> index.html
          echo '            background: var(--card);' >> index.html
          echo '            border: 1px solid var(--border);' >> index.html
          echo '            border-radius: 10px;' >> index.html
          echo '            padding: 20px;' >> index.html
          echo '            text-align: center;' >> index.html
          echo '        }' >> index.html
          echo '        .stat-number {' >> index.html
          echo '            font-size: 2.5rem;' >> index.html
          echo '            font-weight: bold;' >> index.html
          echo '            color: var(--primary);' >> index.html
          echo '        }' >> index.html
          echo '        .file-grid {' >> index.html
          echo '            display: grid;' >> index.html
          echo '            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));' >> index.html
          echo '            gap: 15px;' >> index.html
          echo '            margin-top: 20px;' >> index.html
          echo '        }' >> index.html
          echo '        .file-card {' >> index.html
          echo '            background: var(--card);' >> index.html
          echo '            border: 1px solid var(--border);' >> index.html
          echo '            border-radius: 10px;' >> index.html
          echo '            padding: 15px;' >> index.html
          echo '            display: flex;' >> index.html
          echo '            align-items: center;' >> index.html
          echo '            gap: 15px;' >> index.html
          echo '            text-decoration: none;' >> index.html
          echo '            color: inherit;' >> index.html
          echo '            transition: all 0.2s ease;' >> index.html
          echo '        }' >> index.html
          echo '        .file-card:hover {' >> index.html
          echo '            transform: translateY(-3px);' >> index.html
          echo '            box-shadow: 0 5px 15px rgba(0,0,0,0.1);' >> index.html
          echo '            border-color: var(--primary);' >> index.html
          echo '        }' >> index.html
          echo '        .file-icon {' >> index.html
          echo '            font-size: 2rem;' >> index.html
          echo '            width: 50px;' >> index.html
          echo '            text-align: center;' >> index.html
          echo '        }' >> index.html
          echo '        .file-info {' >> index.html
          echo '            flex: 1;' >> index.html
          echo '        }' >> index.html
          echo '        .file-name {' >> index.html
          echo '            font-weight: 600;' >> index.html
          echo '            margin-bottom: 5px;' >> index.html
          echo '            color: var(--primary);' >> index.html
          echo '            word-break: break-all;' >> index.html
          echo '        }' >> index.html
          echo '        .file-meta {' >> index.html
          echo '            font-size: 0.85rem;' >> index.html
          echo '            color: #6e7781;' >> index.html
          echo '        }' >> index.html
          echo '        .folder-section {' >> index.html
          echo '            margin: 40px 0;' >> index.html
          echo '        }' >> index.html
          echo '        .folder-name {' >> index.html
          echo '            font-size: 1.5rem;' >> index.html
          echo '            margin-bottom: 20px;' >> index.html
          echo '            padding-bottom: 10px;' >> index.html
          echo '            border-bottom: 2px solid var(--border);' >> index.html
          echo '            color: var(--primary);' >> index.html
          echo '        }' >> index.html
          echo '        footer {' >> index.html
          echo '            margin-top: 60px;' >> index.html
          echo '            text-align: center;' >> index.html
          echo '            color: #6e7781;' >> index.html
          echo '            padding-top: 20px;' >> index.html
          echo '            border-top: 1px solid var(--border);' >> index.html
          echo '        }' >> index.html
          echo '        #search {' >> index.html
          echo '            width: 100%;' >> index.html
          echo '            padding: 12px;' >> index.html
          echo '            border: 2px solid var(--border);' >> index.html
          echo '            border-radius: 8px;' >> index.html
          echo '            margin: 20px 0;' >> index.html
          echo '            font-size: 1rem;' >> index.html
          echo '        }' >> index.html
          echo '        @media (max-width: 768px) {' >> index.html
          echo '            .file-grid { grid-template-columns: 1fr; }' >> index.html
          echo '            h1 { font-size: 2rem; }' >> index.html
          echo '        }' >> index.html
          echo '    </style>' >> index.html
          echo '</head>' >> index.html
          echo '<body>' >> index.html
          echo '    <header>' >> index.html
          echo '        <h1>üåø –¶–∏—Ñ—Ä–æ–≤–æ–π —Å–∞–¥</h1>' >> index.html
          echo '        <p class="subtitle">–ü–æ–ª–Ω—ã–π –∞—Ä—Ö–∏–≤ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –∏ –∑–∞–º–µ—Ç–æ–∫</p>' >> index.html
          echo '    </header>' >> index.html
          echo '    <div class="stats-grid">' >> index.html
          echo '        <div class="stat-card">' >> index.html
          echo '            <div class="stat-number" id="total-files">0</div>' >> index.html
          echo '            <div>–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤</div>' >> index.html
          echo '        </div>' >> index.html
          echo '        <div class="stat-card">' >> index.html
          echo '            <div class="stat-number" id="html-files">0</div>' >> index.html
          echo '            <div>HTML —Å—Ç—Ä–∞–Ω–∏—Ü</div>' >> index.html
          echo '        </div>' >> index.html
          echo '        <div class="stat-card">' >> index.html
          echo '            <div class="stat-number" id="folders-count">0</div>' >> index.html
          echo '            <div>–ü–∞–ø–æ–∫</div>' >> index.html
          echo '        </div>' >> index.html
          echo '        <div class="stat-card">' >> index.html
          echo '            <div class="stat-number" id="other-files">0</div>' >> index.html
          echo '            <div>–ü—Ä–æ—á–∏—Ö —Ñ–∞–π–ª–æ–≤</div>' >> index.html
          echo '        </div>' >> index.html
          echo '    </div>' >> index.html
          echo '    <input type="text" id="search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–∞–ø–∫–∏...">' >> index.html
          echo '    <div id="content-container">' >> index.html
          echo '        <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã...</p>' >> index.html
          echo '        <button onclick="loadSampleData()" style="padding:10px 20px;background:#2ea44f;color:white;border:none;border-radius:6px;cursor:pointer;margin-top:15px;">' >> index.html
          echo '            –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö' >> index.html
          echo '        </button>' >> index.html
          echo '    </div>' >> index.html
          echo '    <footer>' >> index.html
          echo '        <p>üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="current-date"></span></p>' >> index.html
          echo '        <p><a href="https://github.com/Story987/Grin" style="color: #0969da;">–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –Ω–∞ GitHub</a></p>' >> index.html
          echo '    </footer>' >> index.html
          echo '    <script>' >> index.html
          echo '        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∫–æ–Ω–∫–∏ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–∞' >> index.html
          echo '        function getFileIcon(filename) {' >> index.html
          echo '            const ext = filename.split(".").pop().toLowerCase();' >> index.html
          echo '            const icons = {' >> index.html
          echo '                "html": "üåê", "htm": "üåê",' >> index.html
          echo '                "md": "üìù", "txt": "üìÑ", "pdf": "üìï",' >> index.html
          echo '                "jpg": "üñºÔ∏è", "jpeg": "üñºÔ∏è", "png": "üñºÔ∏è", "gif": "üñºÔ∏è", "svg": "üñºÔ∏è",' >> index.html
          echo '                "mp3": "üéµ", "wav": "üéµ", "mp4": "üé¨", "avi": "üé¨",' >> index.html
          echo '                "zip": "üóúÔ∏è", "rar": "üóúÔ∏è", "7z": "üóúÔ∏è",' >> index.html
          echo '                "js": "‚ö°", "css": "üé®", "json": "üìä",' >> index.html
          echo '                "doc": "üìò", "docx": "üìò", "xls": "üìó", "xlsx": "üìó"' >> index.html
          echo '            };' >> index.html
          echo '            return icons[ext] || "üìÑ";' >> index.html
          echo '        }' >> index.html
          echo '' >> index.html
          echo '        // –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö' >> index.html
          echo '        function loadSampleData() {' >> index.html
          echo '            const container = document.getElementById("content-container");' >> index.html
          echo '            const folders = [' >> index.html
          echo '                { name: "–ü—Ä–∏–º–µ—Ä —Å–∞–¥–∞ 1", fileCount: 5, totalSize: 10240 },' >> index.html
          echo '                { name: "–ó–∞–º–µ—Ç–∫–∏", fileCount: 3, totalSize: 5120 }' >> index.html
          echo '            ];' >> index.html
          echo '            const files = [' >> index.html
          echo '                { name: "readme.md", size: 1024, type: "Markdown" },' >> index.html
          echo '                { name: "config.json", size: 2048, type: "JSON" },' >> index.html
          echo '                { name: "image.jpg", size: 30720, type: "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" }' >> index.html
          echo '            ];' >> index.html
          echo '' >> index.html
          echo '            let html = "<h2>üìÅ –ü–∞–ø–∫–∏:</h2><div class=\"file-grid\">";' >> index.html
          echo '            folders.forEach(folder => {' >> index.html
          echo '                html += `<a href=\"#\" class=\"file-card\"><div class=\"file-icon\">üìÅ</div><div class=\"file-info\"><div class=\"file-name\">${folder.name}</div><div class=\"file-meta\">${folder.fileCount} —Ñ–∞–π–ª–æ–≤</div></div></a>`;' >> index.html
          echo '            });' >> index.html
          echo '            html += "</div><h2>üìÑ –§–∞–π–ª—ã:</h2><div class=\"file-grid\">";' >> index.html
          echo '            files.forEach(file => {' >> index.html
          echo '                html += `<a href=\"#\" class=\"file-card\"><div class=\"file-icon\">${getFileIcon(file.name)}</div><div class=\"file-info\"><div class=\"file-name\">${file.name}</div><div class=\"file-meta\">${file.type}</div></div></a>`;' >> index.html
          echo '            });' >> index.html
          echo '            html += "</div>";' >> index.html
          echo '            container.innerHTML = html;' >> index.html
          echo '        }' >> index.html
          echo '' >> index.html
          echo '        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É' >> index.html
          echo '        document.getElementById("current-date").textContent = new Date().toLocaleDateString("ru-RU");' >> index.html
          echo '    </script>' >> index.html
          echo '</body>' >> index.html
          echo '</html>' >> index.html
          
          echo "‚úÖ –°–æ–∑–¥–∞–Ω index.html –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤"
        
      # –®–ê–ì 3: –ö–æ–ø–∏—Ä—É–µ–º –í–°–ï —Ñ–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
      - name: Prepare all files for upload
        run: |
          echo "üì¶ –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞—é –≤—Å–µ —Ñ–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ GitHub Pages..."
          
          # –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É —Å–æ –í–°–ï–ú–ò —Ñ–∞–π–ª–∞–º–∏
          mkdir -p ./deploy-ready
          
          # –ö–æ–ø–∏—Ä—É–µ–º –í–°–Å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ src/site/notes/ –≤ deploy-ready
          cp -r src/site/notes/* ./deploy-ready/ 2>/dev/null || true
          
          echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ deploy-ready/:"
          find ./deploy-ready -type f | sed 's|^\./deploy-ready/||' | while read f; do
            echo "  ‚úÖ $f"
          done
        
      # –®–ê–ì 4: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏ –¥–µ–ø–ª–æ–∏–º –í–°–ï —Ñ–∞–π–ª—ã
      - name: Setup GitHub Pages
        uses: actions/configure-pages@v5
        
      - name: Upload ALL files to GitHub Pages
        uses: actions/upload-pages-artifact@v3
        with:
          # –ó–∞–≥—Ä—É–∂–∞–µ–º –í–°–ï —Ñ–∞–π–ª—ã –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞–ø–∫–∏
          path: './deploy-ready/'
        
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
